1. Refactor to transactions
2. Move playerID generation logic to lobby